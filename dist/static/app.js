!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t,n){var r=n(3),o=n(4),i=n(5);e.exports=function(e,t){return r(e)||o(e,t)||i()}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=function e(t){var n=0;!function r(o){var i=e.routes[n++];if(i)if(o){if("middle"===i.method&&3===i.handler.length)return i.handler(t,r,o);r(o)}else if("middle"===i.method){if("/"===i.pathname)return i.handler(t,r);r()}}()};return t.options={token:"",frequency:1,paramEncryption:function(e){return e}},t.routes=[],t.use=function(n){return t.routes.push({method:"middle",pathname:"/",handler:n}),e},t.listen=function(e){},t.init=function(e){t.options=Object.assign(Object.assign({},t.options),e)},t},o=n(2),i=n.n(o),a=n(0),s=n.n(a),u=n(1),c=n.n(u),f=function(){function e(t){var n=this;s()(this,e),this.formatError=function(e,t){var r=e.column||e.columnNumber,o=e.line||e.lineNumber,i=e.message,a=e.name,s=e.stack;if(s){var u=n.getStackInfo(s),c=u.content,f=u.resourceUrl,l=u.stackRow,d=u.stackCol;return Object.assign(Object.assign({},t),{info:{row:Number(o||l),col:Number(r||d),name:a,message:i,content:c,resourceUrl:f}})}return Object.assign(Object.assign({},t),{info:{row:o,col:r,name:a,message:i}})},this.WALL=t,this.createCustomEvent(),this.changeRriginAddEventListener(),this.onError(),this.originOnunhandledrejection(),this.startAddentListener(),this.consoleError()}return c()(e,[{key:"createCustomEvent",value:function(){var e=this;this.WALL.createCustomEvent=function(t){var n={type:"ERROR_CUSTOM",info:Object.assign({},t)};e.WALL(n)}}},{key:"changeRriginAddEventListener",value:function(){var e=EventTarget.prototype.addEventListener;EventTarget.prototype.addEventListener=function(t,n,r){var o=new Error("Event (".concat(t,")")).stack;return e.call(this,t,(function(){try{for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(this,t)}catch(e){throw e.stack+="\n"+o,e}}),r)}}},{key:"onError",value:function(){var e=this,t=window.onerror;window.onerror=function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];var i=r[0],a=r[1],s=r[2],u=r[3],c=r[4],f={type:"ERROR_RUNTIME",info:{}};f.info._errorMessage=i,f.info._scriptURI=a,f.info._lineNumber=s,f.info._columnNumber=u,f=e.formatError(c,f),e.WALL(f),t&&t.apply(window,r)}}},{key:"getStackInfo",value:function(e){var t=e.match(/https?:\/\/[^\n]+/),n=t?t[0]:"",r=/https?:\/\/(\S)*\.js/,o="";r.test(n)&&(o=n.match(r)[0]);var a=null,s=null,u=n.match(/:(\d+):(\d+)/);if(u&&u.length>=3){var c=i()(u,3);a=c[1],s=c[2]}return{content:e,resourceUrl:o,stackRow:s,stackCol:a}}},{key:"originOnunhandledrejection",value:function(){var e=this,t=window.onunhandledrejection;window.onunhandledrejection=function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];var i=r[0];i.preventDefault();var a=i.reason,s={type:"ERROR_PROMISE",info:{message:a}};e.WALL(s),t&&t.apply(window,r)}}},{key:"startAddentListener",value:function(){this.deepTraversal(document.head||{}),this.deepTraversal(document.body||{})}},{key:"deepTraversal",value:function(e){if(!e.childNodes)return!1;var t=[].slice.call(e.childNodes).filter((function(e){return 1===e.nodeType})),n=t.filter((function(e){if(e.tagName)return"img"===e.tagName.toLocaleLowerCase()}));this._bindErrorListenter(n);for(var r=t.filter((function(e){if(e.tagName){var t=e.tagName.toLocaleLowerCase();return"img"!==t&&"script"!==t&&"link"!==t&&"iframe"!==t}})),o=0;o<r.length;o++)this.deepTraversal(r[o])}},{key:"_bindErrorListenter",value:function(e){var t=this;e.forEach((function(e){e.onerror=function(e){var n={type:"IMAGEERROR",info:{message:"图片加载错误",tartget:{alt:e.target.alt,src:e.target.src,path:e.path.filter((function(e){return e.tagName})).map((function(e){return e.tagName.toLocaleLowerCase()}))}}};return t.WALL(n),!0}}))}},{key:"consoleError",value:function(){var e=window.console.error,t=this;window.console.error=function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];var i={type:"ERROR_CONSOLE",info:{message:JSON.stringify(r)}};t.WALL(i),e&&e.apply(window,r)}}}]),e}(),l=function(e,t,n){return window.addEventListener?window.addEventListener(e,t,n):window.attachEvent?window.attachEvent("on"+e,t):void 0},d=function(e,t){return e>0&&t>0&&e-t>=0?e-t:void 0},h=function(e){return e.map((function(e){return{initiatorType:(t=e).initiatorType,name:t.name,duration:parseInt(t.duration),redirect:d(t.redirectEnd,t.redirectStart),dns:d(t.domainLookupEnd,t.domainLookupStart),connect:d(t.connectEnd,t.connectStart),network:d(t.connectEnd,t.startTime),send:d(t.responseStart,t.requestStart),receive:d(t.responseEnd,t.responseStart),request:d(t.responseEnd,t.requestStart),ttfb:d(t.responseStart,t.requestStart)};var t}))},p=function(){function e(t){s()(this,e),this.getXpath=function(e){if(e instanceof Element&&(1===e.nodeType&&e!==document.body)){var t=e.tagName.toLocaleLowerCase();if("html"===t||"body"===t)return!1;for(var n="";e!==document;){n="/"+e.tagName.toLocaleLowerCase()+n,e=e.parentNode}return n}},this.WALL=t,this.listenerClick(),this.listenerHashChange()}return c()(e,[{key:"listenerClick",value:function(){var e=this;document.addEventListener("click",(function(t){var n=e.getXpath(t.target);if(n){var r={type:"BEHAVIOR_XPATH",info:{message:n}};e.WALL(r)}}),!1)}},{key:"listenerHashChange",value:function(){if(!("onhashchange"in window.document.body))return!1;var e,t,n=this,r=0,o={type:"BEHAVIOR_URLCHANGE",info:{}};l("hashchange",(function(t){return r=+new Date,e={oldURL:t.oldURL,newURL:t.newURL},!0}),!1),l("popstate",(function(i){t=+new Date,setTimeout((function(){t-r<400?(o.info.message=e,n.WALL(o)):(o.info.message={kl:0},n.WALL(o),console.log(i))}),500)}),!1)}}]),e}(),v=function(e){var t,n=window.performance||window.mozPerformance||window.msPerformance||window.webkitPerformance;n&&n.getEntries&&(window.PerformanceObserver?new window.PerformanceObserver((function(t){try{var n=t.getEntries(),r={type:"RESCOURCES",info:{message:h(n)}};e(r)}catch(e){console.error(e)}})).observe({entryTypes:["resource"]}):(t=function(){var t=n.getEntriesByType("resource"),r={type:"RESCOURCES",info:{message:h(t)}};e(r)},"complete"===document.readyState&&t(),l("load",t,!1)))},m=function(){function e(t){var n=this;s()(this,e),this.xhr=window.XMLHttpRequest,this.originOpen=this.xhr.prototype.open,this.originSend=this.xhr.prototype.send,this.eventListenerMethods=["load","error","abort"],this.handleEvent=function(e){return function(t){var r=null;if(t.responseType)switch(t.responseType){case"json":r=JSON&&JSON.stringify(t.response).length;break;case"blob":case"moz-blob":r=t.response.size;case"arraybufffer":r=t.response.byteLength;case"document":r=n.getDocumentElement(t);break;default:r=t.response.length}e.senInfo(t,r)}},this.WALL=t,this.xhropen(),this.xhrsend()}return c()(e,[{key:"xhropen",value:function(){var e=this;e.xhr.prototype.open=function(t,n){return e.xhrInfo={url:n,method:t,info:{},type:"XHR",status:null},e.originOpen.apply(this,arguments)}}},{key:"xhrsend",value:function(){var e=this;this.xhr.prototype.send=function(t){var n=this;if(e.param=t,e._eagle_start_time=Date.now(),n.addEventListener)e.eventListenerMethods.reduce((function(t,n){return t.addEventListener(n,e.handleEvent(e),!1),t}),n);else{var r=n.onreadystatechange;n.onreadystatechange=function(t){4==n.readyState&&200==n.status&&e.handleEvent(t),r&&r.apply(this,arguments)}}return e.originSend.apply(this,arguments)}}},{key:"senInfo",value:function(e,t){if(e.currentTarget){var n,r=e.currentTarget;this.xhrInfo.type="XHR",this.xhrInfo.responseSize=t,this.xhrInfo.status=r.status,this.xhrInfo.statusText=r.statusText,this.xhrInfo.success=this.isXhrSuccess(r),this.xhrInfo.duration=Date.now()-this._eagle_start_time,this.xhrInfo.requestDate=this.WALL.options.paramEncryption(this.param),n=this.xhrInfo.success?{type:"XHR",info:Object.assign({},this.xhrInfo)}:{type:"ERROR_XHR",info:Object.assign({},this.xhrInfo)},this.WALL(n)}}},{key:"getDocumentElement",value:function(e){return e.response.documentElement&&e.response.documentElement.innerHTML&&e.response.documentElement.innerHTML.length+28}},{key:"isXhrSuccess",value:function(e){return e.status>=200&&e.status<=206||304===e.status}},{key:"request",value:function(){}}]),e}(),y=r();y.use((function(e,t){e.key=Math.random().toString(36).substring(2),e.createTime=+new Date,t()})),y.use((function(e,t){e.isUpload=!1,Math.random()<y.options.frequency&&(e.isUpload=!0,console.log(e)),t()})),y.listen([new f(y),new m(y),new p(y),v(y)]),window.WALL=y;t.default=y}]);